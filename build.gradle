apply plugin: 'java-library'

compileJava.options.encoding = 'UTF-8'
compileTestJava.options.encoding = "UTF-8"

ext {
    testerraVersion = '1.12'
}

dependencies {
    implementation "io.testerra:driver-ui-desktop:${testerraVersion}"
    implementation "io.testerra:report-ng:${testerraVersion}"
}

test {
    // define as
    //      key: profile name
    //      value: testng suite xml filename
    def profiles = [
            "mySuite": "suite.xml",
            "myFoo": "bar.xml"
    ]

    // create suite def
    def suiteFiles = []
    profiles.each { k, v ->
        if (project.hasProperty("" + k)) {
            def f = 'src/test/resources/' + v
            suiteFiles << f
        }
    }

    /*if (suiteFiles.size() == 0) {
        throw new Exception("No Suites defined, run gradle test with -P[suite], available suites are: " + profiles)
    }
    else {
        println "Suites: " + suiteFiles
    }*/

    useTestNG() {
        suites(suiteFiles as String[])
    }

    testLogging {
        outputs.upToDateWhen { false }
        showStandardStreams = true
    }

    options {
        systemProperties(System.getProperties())
    }

    // basically execution returns "GREEN" (framework exits with exit code > 0 if there were failures)
    ignoreFailures = true
}
